-- V1.1.1__Initial_Schema.sql
-- Create schema and tables for CoinDesk crypto data

-- 1. Historical Daily Data
CREATE OR REPLACE TABLE COINDESK_HISTODAY (
    TIME NUMBER(38,0),
    OPEN FLOAT,
    HIGH FLOAT,
    LOW FLOAT,
    CLOSE FLOAT,
    VOLUME FLOAT,
    PRIMARY KEY (TIME)
);

-- 2. Historical Hourly Data
CREATE OR REPLACE TABLE COINDESK_HISTOHOUR (
    TIME NUMBER(38,0),
    OPEN FLOAT,
    HIGH FLOAT,
    LOW FLOAT,
    CLOSE FLOAT,
    VOLUME FLOAT,
    PRIMARY KEY (TIME)
);

-- 3. Blockchain Balance Distribution (Flattened)
CREATE OR REPLACE TABLE COINDESK_BLOCKCHAIN_BALANCEDISTRIBUTION (
    MERGE_KEY STRING,
    TIME NUMBER(38,0),
    SYMBOL STRING,
    PARTNER_SYMBOL STRING,
    ID NUMBER,
    ADDRESSESCOUNT NUMBER,
    "FROM" FLOAT,
    "TO" FLOAT,
    TOTALVOLUME FLOAT,
    PRIMARY KEY (MERGE_KEY)
);

-- 4. Price Multi Full Snapshots
CREATE OR REPLACE TABLE COINDESK_PRICEMULTIFULL (
    TYPE STRING,
    MARKET STRING,
    FROMSYMBOL STRING,
    TOSYMBOL STRING,
    FLAGS STRING,
    LASTMARKET STRING,
    MEDIAN FLOAT,
    TOPTIERVOLUME24HOUR FLOAT,
    TOPTIERVOLUME24HOURTO FLOAT,
    LASTTRADEID STRING,
    PRICE FLOAT,
    LASTUPDATE NUMBER,
    LASTVOLUME FLOAT,
    LASTVOLUMETO FLOAT,
    VOLUMEHOUR FLOAT,
    VOLUMEHOURTO FLOAT,
    OPENHOUR FLOAT,
    HIGHHOUR FLOAT,
    LOWHOUR FLOAT,
    VOLUMEDAY FLOAT,
    VOLUMEDAYTO FLOAT,
    OPENDAY FLOAT,
    HIGHDAY FLOAT,
    LOWDAY FLOAT,
    VOLUME24HOUR FLOAT,
    VOLUME24HOURTO FLOAT,
    OPEN24HOUR FLOAT,
    HIGH24HOUR FLOAT,
    LOW24HOUR FLOAT,
    CHANGE24HOUR FLOAT,
    CHANGEPCT24HOUR FLOAT,
    CHANGEDAY FLOAT,
    CHANGEPCTDAY FLOAT,
    CHANGEHOUR FLOAT,
    CHANGEPCTHOUR FLOAT,
    CONVERSIONTYPE STRING,
    CONVERSIONSYMBOL STRING,
    CONVERSIONLASTUPDATE NUMBER,
    SUPPLY FLOAT,
    MKTCAP FLOAT,
    MKTCAPPENALTY NUMBER,
    CIRCULATINGSUPPLY FLOAT,
    CIRCULATINGSUPPLYMKTCAP FLOAT,
    TOTALVOLUME24H FLOAT,
    TOTALVOLUME24HTO FLOAT,
    TOTALTOPTIERVOLUME24H FLOAT,
    TOTALTOPTIERVOLUME24HTO FLOAT,
    IMAGEURL STRING,
    FETCHED_AT TIMESTAMP_TZ DEFAULT CURRENT_TIMESTAMP()
);

-- 5. News Data
CREATE OR REPLACE TABLE COINDESK_NEWS (
    ID NUMBER,
    GUID STRING,
    PUBLISHED_ON NUMBER,
    IMAGEURL STRING,
    TITLE STRING,
    URL STRING,
    SOURCE STRING,
    BODY STRING,
    TAGS STRING,
    CATEGORIES STRING,
    UPVOTES NUMBER,
    DOWNVOTES NUMBER,
    LANG STRING,
    SOURCE_INFO VARIANT,
    FETCHED_AT TIMESTAMP_TZ DEFAULT CURRENT_TIMESTAMP(),
    PRIMARY KEY (ID)
);

-- 6. Hourly Social Data
CREATE OR REPLACE TABLE COINDESK_HOURLY_SOCIAL_DATA (
    TIME NUMBER(38,0),
    COMMENTS NUMBER,
    POSTS NUMBER,
    FOLLOWERS NUMBER,
    TWEETS NUMBER,
    REDDIT_ACTIVE_USERS NUMBER,
    REDDIT_POSTS_PER_HOUR FLOAT,
    REDDIT_COMMENTS_PER_HOUR FLOAT,
    REDDIT_POSTS_PER_DAY FLOAT,
    REDDIT_COMMENTS_PER_DAY FLOAT,
    TWITTER_FOLLOWERS NUMBER,
    TWITTER_FAVOURITES NUMBER,
    TWITTER_STATUSES NUMBER,
    FETCHED_AT TIMESTAMP_TZ DEFAULT CURRENT_TIMESTAMP(),
    PRIMARY KEY (TIME)
);

-- 7. Trading Signals (Flattened)
CREATE OR REPLACE TABLE COINDESK_TRADINGSIGNALS (
    INOUTVAR_SENTIMENT STRING,
    INOUTVAR_VALUE FLOAT,
    LTHANDSTH_SENTIMENT STRING,
    LTHANDSTH_VALUE FLOAT,
    CONCENTRATION_SENTIMENT STRING,
    CONCENTRATION_VALUE FLOAT,
    NETNETWORK_SENTIMENT STRING,
    NETNETWORK_VALUE FLOAT,
    LARGESURPLUS_SENTIMENT STRING,
    LARGESURPLUS_VALUE FLOAT,
    FETCHED_AT TIMESTAMP_TZ DEFAULT CURRENT_TIMESTAMP()
);
